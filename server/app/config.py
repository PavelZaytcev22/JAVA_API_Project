import os
from datetime import timedelta
from dotenv import load_dotenv

# Загрузка переменных окружения из файла .env
load_dotenv()

# constants.py или в config.py
USER_ROLES = {
    "admin": "Администратор - полный доступ ко всем данным",
    "user": "Обычный пользователь"
}

ADMIN_PERMISSIONS = [
    "view_all_users",      # Просмотр всех пользователей
    "view_all_homes",      # Просмотр всех домов
    "manage_all_devices",  # Управление всеми устройствами
    "manage_all_homes",    # Управление всеми домами
    "delete_any_user",     # Удаление любых пользователей
    "view_system_stats"    # Просмотр системной статистики
]


# Супер-админ через переменные окружения
SUPER_ADMIN_USERNAME = os.getenv("SUPER_ADMIN_USERNAME", "admin")
SUPER_ADMIN_PASSWORD = os.getenv("SUPER_ADMIN_PASSWORD", "admin123")
SUPER_ADMIN_EMAIL = os.getenv("SUPER_ADMIN_EMAIL", "admin@system.local")


# =============================================================================
# НАСТРОЙКИ БАЗЫ ДАННЫХ
# =============================================================================

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./iot_server.db")
"""
URL для подключения к базе данных:
- По умолчанию: SQLite база в файле iot_server.db
"""

# =============================================================================
# НАСТРОЙКИ JWT АУТЕНТИФИКАЦИИ
# =============================================================================

JWT_SECRET = os.getenv("JWT_SECRET", "supersecretchangeit")
"""
Секретный ключ для подписи JWT токенов:
- Минимальная длина: 32 символа
"""

JWT_ALGORITHM = os.getenv("JWT_ALGORITHM", "HS256")
"""
Алгоритм подписи JWT токенов:
- HS256: HMAC с SHA-256 (рекомендуется)
- RS256: RSA с SHA-256 (для распределенных систем)
"""

ACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv("ACCESS_TOKEN_EXPIRE_MINUTES", "60"))
"""
Время жизни access токена в минутах:
- 60 минут: баланс между безопасностью и удобством
- Для продакшена можно уменьшить до 15-30 минут
"""

# =============================================================================
# НАСТРОЙКИ MQTT БРОКЕРА
# =============================================================================

MQTT_BROKER = os.getenv("MQTT_BROKER", "example.com")
"""
Адрес MQTT брокера
"""

MQTT_PORT = int(os.getenv("MQTT_PORT", "8883"))
"""
Порт MQTT брокера:
- 1883: стандартный порт MQTT (без шифрования)
- 8883: порт для MQTT over SSL/TLS
"""

MQTT_USERNAME = os.getenv("MQTT_USERNAME", "user")
MQTT_PASSWORD = os.getenv("MQTT_PASSWORD", "password")

MQTT_BASE_TOPIC = os.getenv("MQTT_BASE_TOPIC", "smart_home/production")
"""
Базовый префикс для всех MQTT топиков:
- Формат: project/environment/...
- Используется для изоляции разных сред (dev/stage/prod)
"""

# =============================================================================
# НАСТРОЙКИ ВЕБ-СЕРВЕРА
# =============================================================================

HOST = os.getenv("HOST", "0.0.0.0")
"""
Хост для запуска веб-сервера:
- 0.0.0.0: доступ с любых интерфейсов (для Docker)
- 127.0.0.1: только локальный доступ
"""

PORT = int(os.getenv("PORT", "8000"))
"""
Порт для запуска веб-сервера:
- 8000: стандартный порт для разработки
- 80: HTTP порт (требует прав администратора)
- 443: HTTPS порт (требует прав администратора)
"""

# =============================================================================
# НАСТРОЙКИ ЛОГИРОВАНИЯ
# =============================================================================

LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")
"""
Уровень детализации логов:
- DEBUG: максимальная детализация (для разработки)
- INFO: основная информация о работе
- WARNING: только предупреждения и ошибки
- ERROR: только ошибки
"""

# =============================================================================
# НАСТРОЙКИ PUSH-УВЕДОМЛЕНИЙ (FIREBASE CLOUD MESSAGING)
# =============================================================================

FCM_SERVER_KEY = os.getenv("FCM_SERVER_KEY", "YOUR_FIREBASE_SERVER_KEY_HERE")
"""
Серверный ключ для Firebase Cloud Messaging:
- Получить в консоли Firebase: Project Settings → Cloud Messaging
- Формат: "AAAA..."
- Без этого ключа push-уведомления отправляться не будут
"""